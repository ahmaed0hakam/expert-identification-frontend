<div>
  <!-- Main Content -->
  <main class="container-main">
    <!-- Image Selection -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-gray-900 mb-1">{{ 'user.uploadOrCapture' | translate }}</h1>
      <p class="text-gray-600 text-sm">{{ 'user.selectOrCaptureToBegin' | translate }}</p>
    </div>
    <div class="card-lg mb-6">
      
      <div *ngIf="!selectedImage" class="section-spacing">
        <div class="w-full">
          <button (click)="captureImage()" class="btn-primary w-full">
            <app-icon name="camera" size="20" class="flex-shrink-0"></app-icon>
            <span class="text-sm md:text-base">{{ 'user.capturePhoto' | translate }}</span>
          </button>
          <!-- <button (click)="selectFromGallery()" class="btn-secondary">
            <app-icon name="image" size="20" class="flex-shrink-0"></app-icon>
            <span class="text-sm md:text-base">{{ 'user.chooseGallery' | translate }}</span>
          </button> -->
        </div>
        
        <div class="relative">
          <input
            type="file"
            [accept]="imageAcceptAttribute"
            (change)="onFileSelected($event)"
            class="hidden"
            id="file-input"
          />
          <label
            for="file-input"
            class="btn-secondary block w-full text-center cursor-pointer"
          >
            <app-icon name="folder" size="20" class="flex-shrink-0"></app-icon>
            <span class="text-sm md:text-base">{{ 'user.orSelectFile' | translate }}</span>
          </label>
        </div>
      </div>

      <!-- Processing Indicator -->
      <div *ngIf="isProcessing" class="section-spacing">
        <div class="flex flex-col items-center justify-center py-8">
          <svg class="animate-spin h-12 w-12 text-primary mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <p class="text-gray-600 text-sm md:text-base">{{ 'common.loading' | translate }}</p>
        </div>
      </div>

      <!-- AI Search Loader -->
      <div *ngIf="isSearching" class="section-spacing">
        <div class="ai-search-loader">
          <div class="ai-loader-container">
            <!-- Animated Brain/AI Icon -->
            <div class="ai-icon-wrapper">
              <svg class="ai-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C8.13 2 5 5.13 5 9C5 11.38 6.19 13.47 8 14.74V17C8 17.55 8.45 18 9 18H15C15.55 18 16 17.55 16 17V14.74C17.81 13.47 19 11.38 19 9C19 5.13 15.87 2 12 2ZM14 13.7V16H10V13.7C8.89 13.19 8 12.2 7.5 11C7.19 10.3 7 9.66 7 9C7 6.24 9.24 4 12 4S17 6.24 17 9C17 9.66 16.81 10.3 16.5 11C16 12.2 15.11 13.19 14 13.7Z" fill="currentColor"/>
                <circle class="ai-pulse" cx="9" cy="9" r="1.5"/>
                <circle class="ai-pulse" cx="15" cy="9" r="1.5"/>
              </svg>
              <div class="ai-orbits">
                <div class="orbit orbit-1"></div>
                <div class="orbit orbit-2"></div>
                <div class="orbit orbit-3"></div>
              </div>
            </div>
            
            <!-- Loading Text with Animation -->
            <div class="ai-loading-text">
              <span class="ai-text-line">{{ 'user.aiSearching' | translate }}</span>
              <div class="ai-dots">
                <span class="ai-dot"></span>
                <span class="ai-dot"></span>
                <span class="ai-dot"></span>
              </div>
            </div>
            
            <!-- Progress Steps -->
            <div class="ai-steps">
              <div class="ai-step" [class.active]="true">
                <app-icon name="search" size="20" class="step-icon"></app-icon>
                <span class="step-text">{{ 'user.analyzingImage' | translate }}</span>
              </div>
              <div class="ai-step" [class.active]="true">
                <app-icon name="settings" size="20" class="step-icon"></app-icon>
                <span class="step-text">{{ 'user.aiProcessing' | translate }}</span>
              </div>
              <div class="ai-step">
                <app-icon name="check" size="20" class="step-icon"></app-icon>
                <span class="step-text">{{ 'user.findingMatches' | translate }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Folder Selection -->
      <div *ngIf="!isProcessing && !isSearching" class="section-spacing mt-2">
        <app-dropdown
          [options]="folderOptions"
          [selectedValue]="selectedFolderId"
          [placeholder]="'user.allFolders' | translate"
          [disabled]="isLoadingFolders"
          [label]="('user.searchInFolder' | translate) + ' (' + ('common.optional' | translate) + ')'"
          [showClear]="true"
          (selectionChange)="onFolderSelected($event)"
        ></app-dropdown>
      </div>

      <!-- Selected Image Preview -->
      <div *ngIf="selectedImage && !isProcessing && !isSearching" class="section-spacing">
        <div class="relative" *ngIf="selectedFile && selectedImage">
          <img
            [src]="selectedImage"
            alt="Selected image"
            class="image-preview"
          />
          <button
            (click)="clearSelection()"
            class="absolute top-2 right-2 btn-danger rounded-full w-10 h-10 p-0"
            [attr.aria-label]="'user.clear' | translate"
          >
          <app-icon name="trash" size="14"></app-icon>

          </button>
        </div>
        
        <div class="flex flex-col sm:flex-row gap-3 md:gap-4">
          <button
            (click)="search()"
            [disabled]="isSearching || !selectedFile"
            [class.btn-disabled]="isSearching || !selectedFile"
            class="flex-1 btn-primary"
          >
            <span class="flex-center gap-2">
              <app-icon name="search" size="20" class="flex-shrink-0"></app-icon>
              <span class="text-sm md:text-base">{{ 'common.search' | translate }}</span>
            </span>
          </button>
          <button (click)="clearSelection()" class="btn-secondary">
            {{ 'user.clear' | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 md:p-6 mb-6">
      <h3 class="text-base md:text-lg font-semibold text-blue-800 mb-2">{{ 'user.howItWorks' | translate }}</h3>
      <ul class="text-blue-700 space-y-2 text-xs md:text-sm">
        <li class="flex items-start gap-2">
          <app-icon name="check" size="16" color="#1d4ed8" class="flex-shrink-0 mt-0.5"></app-icon>
          <span>{{ 'user.howItWorks1' | translate }}</span>
        </li>
        <li class="flex items-start gap-2">
          <app-icon name="check" size="16" color="#1d4ed8" class="flex-shrink-0 mt-0.5"></app-icon>
          <span>{{ 'user.howItWorks2' | translate }}</span>
        </li>
        <li class="flex items-start gap-2">
          <app-icon name="check" size="16" color="#1d4ed8" class="flex-shrink-0 mt-0.5"></app-icon>
          <span>{{ 'user.howItWorks3' | translate }}</span>
        </li>
      </ul>
    </div>

    <!-- Offline Search Option -->
    <div class="text-center">
      <button
        (click)="navigateToOfflineSearch()"
        class="text-primary-600 hover:text-primary-700 underline text-sm md:text-base transition"
      >
        {{ 'auth.tryOfflineSearch' | translate }}
      </button>
    </div>
  </main>
</div>
